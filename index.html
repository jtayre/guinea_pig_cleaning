<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Guinea Pig Cleaning</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: sans-serif; padding: 20px; text-align: center; }
  h2 { margin-bottom: 10px; }
  .buttons { margin-bottom: 15px; }
  button, input[type="file"] { margin: 0 5px 10px 5px; padding: 10px 15px; font-size: 16px; cursor: pointer; }
  .grid { display: grid; grid-template-columns: repeat(2, 140px); grid-gap: 10px; justify-content: center; }
  .cell { width: 140px; height: 60px; display: flex; justify-content: center; align-items: center; border: 1px solid #ccc; cursor: pointer; flex-direction: column; font-size: 14px; color: white; }
  input[type="date"] { width: 120px; font-size: 14px; }
</style>
</head>
<body>

<h2>Guinea Pig Cleaning</h2>
<div class="buttons">
  <input type="file" id="loadFile" accept=".json">
  <button id="export">Export</button>
</div>
<div class="grid" id="grid"></div>

<script>
const rows = 6;
const cols = 2;
const grid = document.getElementById("grid");
let dates = {};

// Determine cell color based on age and rules
function getCellColor(cellId, dateStr) {
  if (!dateStr) return "#eee"; // no date
  const date = new Date(dateStr);
  const today = new Date();
  const diffDays = Math.floor((today - date)/(1000*60*60*24));
  const index = parseInt(cellId.split(",")[0])*2 + parseInt(cellId.split(",")[1]);

  if (index < 10) { // top 5x2
    if (diffDays >= 7) return "red";
    if (diffDays >= 4) return "orange";
    return "green";
  } else { // bottom 1x2
    if (diffDays >= 4) return "red";
    if (diffDays >= 2) return "orange";
    return "green";
  }
}

// Create grid and attach events
function createGrid() {
  grid.innerHTML = "";
  for (let r = 0; r < rows; r++) {
    for (let c = 0; c < cols; c++) {
      const div = document.createElement("div");
      div.className = "cell";
      div.id = `${r},${c}`;

      const label = document.createElement("span");
      label.innerText = dates[div.id] || "Set Date";
      div.appendChild(label);

      // Apply background color
      div.style.backgroundColor = getCellColor(div.id, dates[div.id]);

      div.addEventListener("click", () => {
        const input = document.createElement("input");
        input.type = "date";
        input.value = dates[div.id] || "";
        input.addEventListener("change", () => {
          dates[div.id] = input.value;
          label.innerText = input.value || "Set Date";
          div.style.backgroundColor = getCellColor(div.id, input.value);
          div.removeChild(input);
          localStorage.setItem("lastDates", JSON.stringify(dates));
        });
        div.appendChild(input);
        input.focus();
      });

      grid.appendChild(div);
    }
  }
}

// Load last JSON from localStorage
window.addEventListener("load", () => {
  const saved = localStorage.getItem("lastDates");
  if (saved) {
    dates = JSON.parse(saved);
  }
  createGrid();
});

// Manual import from OneDrive
document.getElementById("loadFile").addEventListener("change", (event) => {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    try {
      dates = JSON.parse(e.target.result);
      createGrid();
      localStorage.setItem("lastDates", JSON.stringify(dates));
    } catch(err) {
      alert("Invalid JSON file");
    }
  };
  reader.readAsText(file);
});

// Export JSON with default filename
document.getElementById("export").addEventListener("click", () => {
  const blob = new Blob([JSON.stringify(dates, null, 2)], {type: "application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "dates.json"; // default filename
  a.click();
  URL.revokeObjectURL(url);
  alert("JSON exported! Save it to your shared OneDrive folder for syncing.");
});
</script>

</body>
</html>


